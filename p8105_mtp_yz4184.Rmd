---
title: "p8105_mtp_yz4184"
author: "Yunlin Zhou"
date: "10/28/2021"
output: html_document
---
```{r setup, include = FALSE}
library(tidyverse)
library(readxl)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_color_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

# Problem 1

```{r}
# Import data

horns_df = read_excel ("./p8105_mtp_data.xlsx", range = "A9:I1230")

# Clean the data

horns_df  = janitor::clean_names(horns_df)

horns_df = horns_df %>%
  mutate(horns_df,
    sex = recode(sex, `0` = "female", `1` = "male"),
    sex = factor(sex, levels = c("female", "male")),
    age_group = recode(age_group, 
                       `1` = "18-",
                       `2` = "18-30",
                       `3` = "31-40",
                       `4` = "41-50",
                       `5` = "51-60",
                       `6` = "60+",
                       `7` = "60+",
                       `8` = "60+"),
      age_group = factor(age_group,levels = 
                              c("18-30",
                                "31-40",
                                "41-50",
                                "51-60",
                                "60+")),
    eop_size = recode(eop_size, 
                       `0` = "0-5",
                       `1` = "5-10",
                       `2` = "10-15",
                       `3` = "15-20",
                       `4` = "20-25",
                       `5` = "25+"),
    eop_size =factor(eop_size,
                           levels = 
                              c("0-5",
                                "5-10",
                                "10-15",
                                "15-20",
                                "20-25",
                                "25+")),
    eop_visibility_classification = recode(eop_visibility_classification, 
                       `0` = "0",
                       `1` = "0-5",
                       `2` = "5+"),
    eop_visibility_classification =
      factor(eop_visibility_classification, levels = c("0", "0-5", "5+")),
    fhp_category = recode(fhp_category,
                          `0` = "0-10",
                       `1` = "10-20",
                       `2` = "20-30",
                       `3` = "30-40",
                       `4` = "40-50"),
    fhp_category = factor(fhp_category, levels = c("0-10", "10-20", "20-30", "30-40", "40-50")),
    eop_size_mm = replace (eop_size_mm, 
                           is.na (eop_size_mm), 0))%>%
  relocate(sex, age_group)%>%
  arrange(sex,age)%>%
  filter(age_group != "18-")

```

## Describe the data cleaning process

According to the setting in the original table, I replaced the representative number with accurate range, and fill in missing values with data. Also I changed column names into lowercase letters and _. I relocated the column orders and reorder the rows by sex and age. 

## Describe the resulting dataset

```{r results='hide', echo = FALSE}

ncol(horns_df)
nrow(horns_df)
count(horns_df,sex)
count(horns_df, age_group)

```

There are `r ncol(horns_df) ` variables and `r nrow(horns_df) ` participants which included 614 female and 607 male. There are 2 people under 18, 303 people from 18 to 30, 204 people from 31 to 40, 207 people from 41 to 50, 200 people from 51 to 60 and 305 people above 60. The key vairaibles are sex, FHP and age.

## issues in the available data


# Problem 2 

```{r}
# FHP histogram

fhp_his_plot = 
  horns_df %>%
  ggplot(aes(x = fhp_size_mm, fill = sex))+
  geom_histogram(position = "dodge", binwidth = 2)+ 
  labs(
    title = "FHP size histogram",
    x = "FHP size (mm)",
    y = "Different FHP size number"
  )

fhp_his_plot
```


```{r}
# The rate of enlarged EOP in each age group

rate_df = horns_df %>%
  count(age_group, sex, eop_size)

eop = rate_df%>%
  filter(eop_size%in%c("10-15","15-20","20-25","25+"))%>%
  group_by(age_group,sex)%>%
  summarise(eop_num = sum(n))

total = rate_df%>%
  group_by(age_group,sex)%>%
  summarise(total_num = sum(n))

rate_df = left_join(eop, total)%>%
  mutate(rate = eop_num/total_num,
         age_group_num = recode(age_group,
                                `18-30` = 1,
                                `31-40` = 2,
                                `41-50` = 3,
                                `51-60` = 4,
                                `60+` = 5))

rate_df_plot = ggplot(rate_df, aes(x = age_group_num, y = rate, color =sex))+
  geom_point()+
  geom_line()+
  labs(
    title = "The rate of enlarged EOP in each age group",
    x = "Age group (years)",
    y = "The rate of enlarged EOP"
  ) + 
  scale_x_continuous(
    labels = c("18-30", "31-40", "41-50", "51-60", "60+")
  ) 

rate_df_plot

```

```{r fig.asp = 2}
eop_fhp = 
horns_df%>%
  filter(age_group != "18-")%>%
ggplot(aes(x = eop_size_mm, y = fhp_size_mm))+
  geom_point()+
  labs(
    title = "The association between FHP size and EOP size",
    x = "EOP size (mm)",
    y = "FHP size (mm)"
  ) + 
  scale_x_continuous(
    breaks = c(10, 20, 30),
    labels = c("10", "20", "30")
  )+
  facet_wrap(vars(sex,age_group), ncol = 2)

eop_fhp
```
